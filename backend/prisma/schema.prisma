generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String
  type      String
  products  Product[]
}

model Product {
  id          Int      @id @default(autoincrement())
  type        String
  categoryId  Int
  category    Category @relation(fields: [categoryId], references: [id])
  name        String
  vendorCode  String
  description String?
  material    String
  color       String
  size        String
  shape       String?
  price       Float
  currency    String
  inStock     Int
  packageInfo String?
  images      String[]
  flags       Json?
  orderItems  OrderItem[]
}

model Customer {
  id               Int    @id @default(autoincrement())
  telegram_user_id String @unique
  username         String?
  first_name       String?
  last_name        String?
  phone            String?
  email            String?
  orders           Order[]
}

model Order {
  id             Int        @id @default(autoincrement())
  customerId     Int
  customer       Customer   @relation(fields: [customerId], references: [id])
  total_price    Float
  currency       String     @default("RUB")
  delivery_type  String
  payment_type   String
  status         String     @default("new")
  city           String
  address        String?
  pickup_pointId Int?
  pickup_point   PickupPoint? @relation(fields: [pickup_pointId], references: [id])
  comment        String?
  created_at     DateTime   @default(now())
  updated_at     DateTime   @updatedAt
  orderItems     OrderItem[]
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  order     Order   @relation(fields: [orderId], references: [id])
  productId Int
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float
  subtotal  Float
}

model PickupPoint {
  id            Int     @id @default(autoincrement())
  name          String
  city          String
  address       String
  working_hours String
  is_active     Boolean @default(true)
  orders        Order[]
}
